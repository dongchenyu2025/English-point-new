<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Point & Learn</title>
    <link rel="stylesheet" href="src/styles/common.css">
    <link rel="stylesheet" href="src/styles/HomePage.css">
    <link rel="stylesheet" href="src/styles/ScenePage.css">
    <link rel="stylesheet" href="src/styles/ThemePage.css">
    <link rel="stylesheet" href="src/styles/WordMarking.css">
</head>
<body>
    <div id="app">
        <!-- Homepage will be loaded here -->
        <div id="homepage" class="page active">
            <!-- ä¸»é¡µå†…å®¹å°†ç”±HomePage.jsåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <!-- Scene page will be loaded here -->
        <div id="scenepage" class="page">
            <header class="scene-header">
                <button id="back-btn" class="back-button">â†</button>
                <h2 id="scene-title">Scene Name</h2>
                <div class="display-controls">
                    <button id="english-btn" class="display-btn active">è‹±æ–‡</button>
                    <button id="phonetic-btn" class="display-btn">éŸ³æ ‡</button>
                    <button id="chinese-btn" class="display-btn">ä¸­æ–‡</button>
                </div>
            </header>

            <main class="scene-container">
                <div id="scene-image-container" class="scene-image-container">
                    <img id="scene-image" src="" alt="Scene Image">
                    <div id="hotspots-container"></div>
                </div>
            </main>
        </div>
    </div>

    <script src="src/services/SceneDataService.js"></script>
    <script src="src/services/ThemeDataService.js"></script>
    <script src="src/services/UserProgressService.js"></script>
    <script src="src/services/AudioService.js"></script>
    <script src="src/utils/PerformanceMonitor.js"></script>
    <script src="src/components/WordHotspot.js"></script>
    <script src="src/components/DisplayController.js"></script>
    <script src="src/components/HomePage.js"></script>
    <script src="src/components/ScenePage.js"></script>
    <script>
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ¯ App initializing...');

            // Initialize audio service first
            window.audioService = new AudioService();
            console.log('ğŸ¯ AudioService created:', window.audioService);

            // Initialize theme data service
            if (window.themeDataService) {
                window.themeDataService.initialize();
                console.log('ğŸ¯ ThemeDataService initialized');
            }

            // Initialize user progress service
            if (window.userProgressService) {
                console.log('ğŸ¯ UserProgressService initialized');
            }

            // Test TTS availability
            if ('speechSynthesis' in window) {
                console.log('ğŸ¯ TTS available, voices:', speechSynthesis.getVoices().length);

                // åŸºäºå‚è€ƒæ–¹æ¡ˆçš„ç®€å•TTSæµ‹è¯•å‡½æ•°
                window.testTTS = function(word = 'hello') {
                    console.log('ğŸ”Š æµ‹è¯•TTS:', word);

                    if ('speechSynthesis' in window) {
                        const utterance = new SpeechSynthesisUtterance(word);
                        utterance.lang = 'en-US';
                        utterance.rate = 0.8;
                        window.speechSynthesis.speak(utterance);
                        console.log('âœ… TTSå‘½ä»¤å·²å‘é€');
                    } else {
                        console.log('âŒ æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆ');
                    }
                };

                // æœ€ç®€å•çš„TTSæ–¹æ³•
                window.simpleTTS = function(word) {
                    console.log('ğŸ”Š æœ€ç®€å•TTS:', word);
                    window.speechSynthesis.speak(new SpeechSynthesisUtterance(word));
                };

                // ç­‰å¾…è¯­éŸ³åŠ è½½åæµ‹è¯•
                speechSynthesis.addEventListener('voiceschanged', () => {
                    console.log('ğŸ¯ è¯­éŸ³åˆ—è¡¨å·²åŠ è½½ï¼Œå¯ç”¨è¯­éŸ³:', speechSynthesis.getVoices().length);
                });

            } else {
                console.log('ğŸ¯ TTS not available');
            }

            // é¢„æ¿€æ´»TTSæƒé™ - ç”¨æˆ·é¦–æ¬¡ç‚¹å‡»æ—¶æ¿€æ´»
            function initTTSPermission() {
                if ('speechSynthesis' in window) {
                    console.log('ğŸ”Š Initializing TTS permission on user interaction...');

                    // æ’­æ”¾æ— å£°æµ‹è¯•æ¥æ¿€æ´»TTSæƒé™
                    const testUtterance = new SpeechSynthesisUtterance('');
                    testUtterance.volume = 0;
                    testUtterance.rate = 10;

                    try {
                        speechSynthesis.speak(testUtterance);
                        console.log('ğŸ”Š âœ… TTS permission activated');
                    } catch (error) {
                        console.log('ğŸ”Š âš ï¸ TTS permission activation failed:', error);
                    }

                    // ç§»é™¤ç›‘å¬å™¨ï¼Œåªéœ€è¦æ¿€æ´»ä¸€æ¬¡
                    document.removeEventListener('click', initTTSPermission);
                    document.removeEventListener('touchstart', initTTSPermission);
                }
            }

            // ç›‘å¬ç”¨æˆ·é¦–æ¬¡äº¤äº’æ¥æ¿€æ´»TTS
            document.addEventListener('click', initTTSPermission, { once: true });
            document.addEventListener('touchstart', initTTSPermission, { once: true });

            window.homePage = new HomePage();
            window.scenePage = new ScenePage();

            console.log('ğŸ¯ App initialization completed');
        });
    </script>
</body>
</html>